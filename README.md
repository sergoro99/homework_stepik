# Декораторы в Python

Этот репозиторий содержит реализацию нескольких полезных декораторов в Python, которые демонстрируют различные возможности декораторов и показывают, как их можно использовать для решения конкретных задач.

## Содержание

1.  [Описание](#описание)
2.  [Установка](#установка)
3.  [Использование](#использование)
    *   [`@benchmark`](#benchmark)
    *   [`@logging`](#logging)
    *   [`@counter`](#counter)
    *   [`@memo`](#memo)
4. [Комбинация декораторов](#комбинация-декораторов)
5.  [Пример с числами Фибоначчи](#пример-с-числами-фибоначчи)
6.  [Лицензия](#лицензия)

## Описание

В этом репозитории представлены четыре пользовательских декоратора:

*   `@benchmark`: измеряет и выводит время выполнения декорируемой функции.
*   `@logging`: выводит параметры, с которыми была вызвана декорируемая функция.
*   `@counter`: считает и выводит количество вызовов декорируемой функции.
*   `@memo`: мемоизирует (кэширует) результаты выполнения декорируемой функции для хешируемых аргументов, позволяя избежать повторных вычислений.

Эти декораторы могут быть полезны при отладке кода, оптимизации производительности и для более глубокого понимания работы функций.

## Установка

1.  Склонируйте репозиторий на свой компьютер:

    ```bash
    git clone <URL_вашего_репозитория>
    ```

2.  Перейдите в директорию репозитория:

    ```bash
    cd <имя_директории_репозитория>
    ```

## Использование

### `@benchmark`

Декоратор `@benchmark` измеряет и выводит время выполнения декорируемой функции. Это может быть полезно для анализа производительности вашего кода.

**Пример:**

```python
import time

def benchmark(func):
    """
    Декоратор, выводящий время, которое заняло выполнение декорируемой функции
    """

    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        res_time = time.time() - start
        print(f'Время выполнения функции {func.__name__}: {res_time:.6f}')
        return result

    return wrapper
```

### `@logging`
Декоратор `@logging` выводит параметры, с которыми была вызвана декорируемая функция, для отладки и логирования.

**Пример:**

```python
def logging(func):
    """
    Декоратор, который выводит параметры с которыми была вызвана функция
    """

    def wrapper(*args, **kwargs):
        print(f'Функция вызвана с параметрами:\n{args}, {kwargs}')
        result = func(*args, **kwargs)
        return result

    return wrapper
```

### `@counter`

Декоратор `@counter` подсчитывает и выводит количество вызовов декорируемой функции. Это может быть полезно для мониторинга использования функций.

**Пример:**

```python
def counter(func):
    """
    Декоратор, считающий и выводящий количество вызовов декорируемой функции
    """
    c = 0
    def wrapper(*args, **kwargs):
        nonlocal c
        c += 1
        print(f'Функция была вызвана: {c} раз')
        result = func(*args, **kwargs)
        return result
    ...
    return wrapper
```

### `@memo`

Декоратор `@memo` мемоизирует (кэширует) результаты выполнения декорируемой функции для хешируемых аргументов, позволяя избежать повторных вычислений. Он использует словарь для хранения результатов.

**Пример:**

```python
def memo(func):
  """
  Декоратор, запоминающий результаты исполнения функции func, чьи аргументы args должны быть хешируемыми
  """
  cache = {}

  def fmemo(*args):
    if args in cache:
      result = cache[args]
      print(f'Результат по данным аргументам {args} есть в памяти')
      return result
    result = func(*args)
    cache[args] = result
    return result

  fmemo.cache = cache
  return fmemo
```

**Комбинация декораторов**

Декораторы можно комбинировать, чтобы применять несколько эффектов к одной функции. В следующем примере показано, как работают `@counter`, `@logging`, и `@benchmark` одновременно.

**Пример:**

```python
@counter
@logging
@benchmark
def word_count(word, url=BOOK_PATH):
    """
    Функция для посчета указанного слова на html-странице
    """

    # отправляем запрос в библиотеку Gutenberg и забираем текст
    raw = requests.get(url).text

    # заменяем в тексте все небуквенные символы на пробелы
    processed_book = re.sub('[\W]+' , ' ', raw).lower()

    # считаем
    cnt = len(re.findall(word.lower(), processed_book))

    return f"Cлово {word} встречается {cnt} раз"

print(word_count('whole'))
```

**Вывод:**

```python
Функция была вызвана: 1 раз
Функция вызвана с параметрами:
('whole',), {}
Время выполнения функции word_count: 2.153066
Cлово whole встречается 176 раз
```

**Пример с числами Фибоначчи**

Для демонстрации эффективности @memo был протестирован расчет чисел Фибоначчи. Мемоизация значительно сокращает время выполнения, избегая многократного пересчета уже вычисленных значений. Для более детального тестирования вы можете убрать декоратор `@memo` и оценить время вычисления чисел Фибоначчи, например, 10.

**Пример без использования `@memo`**
```pyhton
@benchmark
def fib(n):
    if n < 2:
        return n
    return fib(n-2) + fib(n-1)

# измеряем время выполнения
print(fib(10))
```

**Вывод:**

```python
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000002
Время выполнения функции fib: 0.001616
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000037
Время выполнения функции fib: 0.000072
Время выполнения функции fib: 0.001722
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000063
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000032
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000033
Время выполнения функции fib: 0.000063
Время выполнения функции fib: 0.000126
Время выполнения функции fib: 0.000219
Время выполнения функции fib: 0.001974
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000032
Время выполнения функции fib: 0.000065
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000061
Время выполнения функции fib: 0.000121
Время выполнения функции fib: 0.000216
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000032
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000059
Время выполнения функции fib: 0.000129
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000049
Время выполнения функции fib: 0.000083
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000031
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000033
Время выполнения функции fib: 0.000072
Время выполнения функции fib: 0.000132
Время выполнения функции fib: 0.000263
Время выполнения функции fib: 0.000423
Время выполнения функции fib: 0.000670
Время выполнения функции fib: 0.002677
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000034
Время выполнения функции fib: 0.000080
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.001102
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000032
Время выполнения функции fib: 0.000067
Время выполнения функции fib: 0.001227
Время выполнения функции fib: 0.001346
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000060
Время выполнения функции fib: 0.000119
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000060
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000036
Время выполнения функции fib: 0.000066
Время выполнения функции fib: 0.000126
Время выполнения функции fib: 0.000216
Время выполнения функции fib: 0.000364
Время выполнения функции fib: 0.001739
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000002
Время выполнения функции fib: 0.036160
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.006465
Время выполнения функции fib: 0.006585
Время выполнения функции fib: 0.042813
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000058
Время выполнения функции fib: 0.000120
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000053
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000058
Время выполнения функции fib: 0.000111
Время выполнения функции fib: 0.000218
Время выполнения функции fib: 0.000422
Время выполнения функции fib: 0.044307
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000051
Время выполнения функции fib: 0.000103
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000050
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000052
Время выполнения функции fib: 0.000103
Время выполнения функции fib: 0.000203
Время выполнения функции fib: 0.000352
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000051
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000050
Время выполнения функции fib: 0.000099
Время выполнения функции fib: 0.000198
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000071
Время выполнения функции fib: 0.000122
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000050
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000000
Время выполнения функции fib: 0.000052
Время выполнения функции fib: 0.000108
Время выполнения функции fib: 0.000206
Время выполнения функции fib: 0.000373
Время выполнения функции fib: 0.000628
Время выполнения функции fib: 0.001031
Время выполнения функции fib: 0.045398
Время выполнения функции fib: 0.047190
Время выполнения функции fib: 0.049919
55
```

**Пример с использованием `@memo`**

```python
@memo
@benchmark
def fib(n):
    if n < 2:
        return n
    return fib(n-2) + fib(n-1)
```

**Вывод:**

```python
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000001
Время выполнения функции fib: 0.000116
Результат по данным аргументам (1,) есть в памяти
Результат по данным аргументам (2,) есть в памяти
Время выполнения функции fib: 0.000040
Время выполнения функции fib: 0.000191
Результат по данным аргументам (3,) есть в памяти
Результат по данным аргументам (4,) есть в памяти
Время выполнения функции fib: 0.000048
Время выполнения функции fib: 0.000274
Результат по данным аргументам (5,) есть в памяти
Результат по данным аргументам (6,) есть в памяти
Время выполнения функции fib: 0.000030
Время выполнения функции fib: 0.000338
Результат по данным аргументам (7,) есть в памяти
Результат по данным аргументам (8,) есть в памяти
Время выполнения функции fib: 0.000031
Время выполнения функции fib: 0.000408
55
```


***Автор: Сергей Горохов***
